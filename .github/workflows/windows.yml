name: Windows RDP via Tailscale
on: [workflow_dispatch]

jobs:
  windows-remote:
    runs-on: windows-latest # ğŸ‘ˆ å…³é”®ï¼šè¿™é‡Œæ”¹æˆäº† Windows
    steps:
      # 1. è¿æ¥ Tailscale (å’Œä¹‹å‰ä¸€æ ·)
      - name: Connect to Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.zeigonfo }}
          version: 1.94.1  # ä¿æŒè¿™ä¸ªç¨³å®šç‰ˆæœ¬
          hostname: github-windows-box # ç»™å®ƒèµ·ä¸ªä¸ä¸€æ ·çš„åå­—

      # 2. é…ç½® Windows è¿œç¨‹æ¡Œé¢ç¯å¢ƒ (PowerShell)
      - name: Setup RDP & Password
        run: |
          # (A) è®¾ç½®ç”¨æˆ· 'runneradmin' çš„å¯†ç 
          # æ³¨æ„ï¼šWindows å¯†ç ç­–ç•¥è¦æ±‚ç¨å¾®å¤æ‚ä¸€ç‚¹ (æœ‰å¤§å†™ã€å°å†™ã€æ•°å­—)
          net user runneradmin "Aa@111111" 

          # (B) ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œå…è®¸è¿œç¨‹æ¡Œé¢è¿æ¥ (fDenyTSConnections = 0)
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0

          # (C) å¼€å¯é˜²ç«å¢™å…è®¸ RDP ç«¯å£ (3389)
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

          # (D) æ˜¾ç¤º IP åœ°å€
          Write-Host "=========================================="
          Write-Host "ğŸ‰ Windows ç¯å¢ƒå‡†å¤‡å°±ç»ªï¼"
          Write-Host "ä½ çš„ Tailscale IP åœ°å€æ˜¯ï¼š"
          tailscale ip -4
          Write-Host "ç”¨æˆ·å: runneradmin"
          Write-Host "å¯†ç :   PassWord123456!"
          Write-Host "=========================================="

      # 3. ä¿æŒè¿è¡Œ (6 å°æ—¶)
      - name: Keep Alive
        run: Start-Sleep -Seconds 21600
