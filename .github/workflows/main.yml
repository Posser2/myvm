name: Tailscale Ultimate Connection
on: [workflow_dispatch] # æ‰‹åŠ¨æŒ‰é’®è§¦å‘

jobs:
  high-speed-vps:
    runs-on: ubuntu-latest
    steps:
      # 1. è¿æ¥åˆ° Tailscale ç½‘ç»œ
      - name: Connect to Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.zeigonfo }}
          version: 1.94.1
          # ç»™å®ƒèµ·ä¸ªåå­—ï¼Œæ–¹ä¾¿ä½ åœ¨åˆ—è¡¨é‡Œè®¤å‡ºæ¥
          hostname: github-action-runner

      # 2. å¼€å¯ SSH å¹¶è®¾ç½®å¯†ç 
      - name: Enable SSH & Set Password
        run: |
          # è®¾ç½®ç”¨æˆ· 'runner' çš„å¯†ç ä¸º '123456'
          # æ³¨æ„ï¼šè¿™æ˜¯ä¸´æ—¶ç¯å¢ƒï¼Œå¯†ç ç®€å•ç‚¹æ²¡äº‹ï¼Œåæ­£åªæœ‰ä½ èƒ½è¿
          echo "runner:123456" | sudo chpasswd
          
          # å¯åŠ¨ SSH æœåŠ¡
          sudo systemctl start ssh
          
          # æ˜¾ç¤ºå®ƒçš„ Tailscale IP åœ°å€ï¼Œæ–¹ä¾¿ä½ å¤åˆ¶
          echo "=========================================="
          echo "ğŸ‰ è¿æ¥æˆåŠŸï¼"
          echo "ä½ çš„ Runner IP åœ°å€æ˜¯ï¼š"
          tailscale ip -4
          echo "=========================================="

      # 3. ä¿æŒè¿è¡Œ (æœ€å¤š 6 å°æ—¶)
      - name: Keep Alive
        run: sleep 21600
